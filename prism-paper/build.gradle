plugins {
    id 'prism.java-conventions'
    id 'com.gradleup.shadow' version '9.0.0-beta11'
}

repositories {
    // WorldEdit
    maven { url = 'https://maven.enginehub.org/repo/' }
    // FastAsyncWorldEdit
    maven { url = 'https://repo.papermc.io/repository/maven-public/' }
    
    // Claim protection plugins
    maven { url = 'https://repo.bg-software.com/repository/api/' }  // SuperiorSkyblock
    
    // Local libs directory
    flatDir {
        dirs '../libs'
    }
}

dependencies {
    compileOnly project.property('deps.caffeine')
    compileOnly project.property('deps.configurate-hocon')
    compileOnly project.property('deps.cronutils')
    compileOnly project.property('deps.guice')
    compileOnly project.property('deps.guice-assistedinject')
    compileOnly project.property('deps.jackson-core')
    compileOnly project.property('deps.jackson-databind')
    compileOnly project.property('deps.jar-relocator')
    compileOnly project.property('deps.jooq')
    compileOnly project.property('deps.log4j-api')
    compileOnly project.property('deps.log4j-core')
    compileOnly project.property('deps.moonshine-core')
    compileOnly project.property('deps.moonshine-standard')
    compileOnly project.property('deps.nbt-api')
    compileOnly project.property('deps.p6spy')
    compileOnly project.property('deps.paper-api')
    compileOnly project.property('deps.quartz')
    compileOnly project.property('deps.taskchain')
    compileOnly project.property('deps.triumph-gui')
    compileOnly project.property('deps.world-edit-core')
    compileOnly project.property('deps.world-edit-bukkit')
    compileOnly project.property('deps.fawe-core')
    compileOnly project.property('deps.fawe-bukkit')
    compileOnly project(':prism-api')
    compileOnly project(':prism-loader')

    // Claim protection plugins (compileOnly - provided by server at runtime)
    // Using local libs folder
    compileOnly name: 'plotsquared-bukkit-7.5.9-Premium'
    compileOnly name: 'Residence6.0.1.1'
    compileOnly name: 'griefdefender-bukkit-3.1.3'
    compileOnly name: 'Lands-7.16.0'
    compileOnly name: 'FactionsX-1.2-STABLE'
    compileOnly name: 'BentoBox-3.9.2'
    
    // From Maven repositories
    compileOnly 'com.bgsoftware:SuperiorSkyblockAPI:2023.3'

    implementation project.property('deps.triumph-cmd-bukkit')
    implementation project(':prism-core')
    implementation project(':prism-paper-api')
}

// "parameters" flag required for moonshine to work
compileJava {
    options.compilerArgs += ["-parameters"]
}

shadowJar {
    archiveFileName = 'prism-paper.jarinjar'

    relocate 'co.aikar.taskchain', 'org.prism_mc.prism.libs.taskchain'
    relocate 'com.cronutils', 'org.prism_mc.prism.libs.cronutils'
    relocate 'com.fasterxml.jackson', 'org.prism_mc.prism.libs.jackson'
    relocate 'com.github.benmanes.caffeine', 'org.prism_mc.prism.libs.caffeine'
    relocate 'com.google.inject', 'org.prism_mc.prism.libs.inject'
    relocate 'com.h2database', 'org.prism_mc.prism.libs.h2'
    relocate 'com.mysql', 'org.prism_mc.prism.libs.mysql'
    relocate 'com.p6spy.engine', 'org.prism_mc.prism.libs.p6spy'
    relocate 'com.typesafe.config', 'org.prism_mc.prism.libs.hocon'
    relocate 'com.zaxxer.hikari', 'org.prism_mc.prism.libs.hikari'
    relocate 'dev.triumphteam', 'org.prism_mc.prism.libs.triumphteam'
    relocate 'io.leangen.geantyref', 'org.prism_mc.prism.libs.geantyref'
    relocate 'net.kyori.moonshine', 'org.prism_mc.prism.libs.kyori.moonshine'
    relocate 'org.aopalliance', 'org.prism_mc.prism.libs.aopalliance'
    relocate 'org.jooq', 'org.prism_mc.prism.libs.jooq'
    relocate 'org.mariadb', 'org.prism_mc.prism.libs.mariadb'
    relocate 'org.postgresql', 'org.prism_mc.prism.libs.postgresql'
    relocate 'org.quartz', 'org.prism_mc.prism.libs.quartz'
    relocate 'org.spongepowered.configurate', 'org.prism_mc.prism.libs.configurate'
}

artifacts {
    archives shadowJar
}